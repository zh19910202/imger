# AnnotateFlow Assistant 扩展测试说明

## 如何加载和测试扩展

### 1. 在Chrome浏览器中加载扩展

1. 打开Chrome浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择这个项目文件夹（`d:\app\imgerV2`）
6. 扩展应该会出现在扩展列表中

### 2. 测试扩展功能

#### 方法一：使用本地测试页面
1. 确保扩展已加载
2. 在浏览器中访问：`http://localhost:8080/test.html`
3. 按F12打开开发者工具，查看Console标签
4. 测试以下功能：
   - 按 **R** 键切换模式（应该看到模式显示器和控制台日志）
   - 按 **M** 键打印返修模式状态
   - 观察右上角的模式显示器是否出现

#### 方法二：在腾讯QLabel平台测试
1. 访问：`https://qlabel.tencent.com/`
2. 登录并进入标注任务
3. 测试所有快捷键功能

### 3. 调试模式显示器问题

如果模式显示器不显示，请检查：

1. **控制台日志**：按F12打开开发者工具，查看Console中的调试信息
2. **扩展状态**：确认扩展已正确加载且处于启用状态
3. **页面匹配**：确认当前页面URL匹配manifest.json中的规则

### 4. 预期的调试日志

正常情况下，在控制台中应该看到以下日志：

```
[AnnotateFlow] 创建模式状态指示器...
[AnnotateFlow] 模式指示器已创建
[AnnotateFlow] 模式指示器已添加到DOM
[AnnotateFlow] 模式指示器样式已设置
[AnnotateFlow] 显示当前模式被调用
[AnnotateFlow] 更新模式状态指示器: 普通标注模式
```

### 5. 常见问题

- **扩展不工作**：检查是否在支持的页面上（localhost或qlabel.tencent.com）
- **没有日志输出**：确认扩展已正确加载，刷新页面重试
- **模式显示器不显示**：检查控制台错误信息，可能是CSS样式问题

### 6. 功能测试清单

- [ ] R键切换模式功能
- [ ] 模式显示器显示和隐藏
- [ ] 点击模式显示器切换模式
- [ ] 拖拽移动模式显示器
- [ ] 双击重置模式显示器位置
- [ ] M键打印返修模式状态
- [ ] 控制台调试日志输出
- [ ] 模式状态持久化（跨页面保持）

### 7. 模式持久化功能

**重要特性**：返修模式一旦开启，除非用户手动关闭，否则会一直保持返修模式状态，即使跳转到新页面也会自动恢复。

**测试步骤**：
1. 按R键切换到返修模式
2. 刷新页面或跳转到其他页面
3. 观察是否自动恢复到返修模式
4. 再次按R键切换回普通模式
5. 刷新页面，确认保持普通模式

**技术实现**：
- 使用Chrome存储API (chrome.storage.sync) 保存模式状态
- 页面加载时自动从存储中恢复模式状态
- 模式切换时立即保存到存储
- 支持跨设备同步（如果Chrome账户已登录）